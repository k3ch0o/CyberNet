<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador de Etiquetas - Zebra ZD421</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 30px 0;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-section i {
      font-size: 2.5rem;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 5px;
    }

    .subtitle {
      font-size: 1rem;
      opacity: 0.9;
    }

    .connection-status {
      background-color: rgba(255, 255, 255, 0.15);
      padding: 10px 15px;
      border-radius: 50px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #ff4757;
    }

    .status-indicator.connected {
      background-color: #2ed573;
    }

    main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background-color: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    .card h2 {
      color: #1e3c72;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f2f5;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card h2 i {
      color: #2a5298;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #444;
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .form-control:focus {
      outline: none;
      border-color: #2a5298;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .checkbox-group input {
      width: auto;
    }

    .preview-container {
      border: 1px solid #ddd;
      border-radius: 5px;
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f9f9f9;
      overflow: hidden;
    }

    .label-preview {
      width: 4in;
      height: 3in;
      background-color: white;
      position: relative;
      border: 1px dashed #ccc;
      transform: scale(0.85);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .preview-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 15px;
    }

    .preview-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
    }

    .preview-barcode {
      margin: 15px 0;
      display: flex;
      justify-content: center;
    }

    .barcode-placeholder {
      width: 80%;
      height: 80px;
      background-color: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #666;
    }

    .preview-details {
      margin-top: 10px;
      font-size: 14px;
    }

    .preview-details div {
      margin-bottom: 5px;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 25px;
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background-color: #2a5298;
      color: white;
    }

    .btn-primary:hover {
      background-color: #1e3c72;
    }

    .btn-secondary {
      background-color: #f1f2f6;
      color: #333;
    }

    .btn-secondary:hover {
      background-color: #dfe4ea;
    }

    .btn-success {
      background-color: #2ed573;
      color: white;
    }

    .btn-success:hover {
      background-color: #20bf6b;
    }

    .btn-danger {
      background-color: #ff6b81;
      color: white;
    }

    .btn-danger:hover {
      background-color: #ff4757;
    }

    .zpl-output {
      grid-column: span 2;
    }

    @media (max-width: 900px) {
      .zpl-output {
        grid-column: span 1;
      }
    }

    .zpl-container {
      background-color: #2d3436;
      color: #dfe6e9;
      border-radius: 5px;
      padding: 20px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin-top: 10px;
    }

    .instructions {
      background-color: #fff9e6;
      border-left: 4px solid #ff9f43;
      padding: 15px;
      margin-top: 20px;
      border-radius: 0 5px 5px 0;
    }

    .instructions h3 {
      color: #e67e22;
      margin-bottom: 10px;
    }

    .instructions ol {
      padding-left: 20px;
    }

    .instructions li {
      margin-bottom: 8px;
    }

    footer {
      text-align: center;
      padding: 20px;
      color: #666;
      border-top: 1px solid #eee;
      margin-top: 30px;
    }

    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 20px;
      background-color: #2ed573;
      color: white;
      border-radius: 5px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      display: none;
      align-items: center;
      gap: 10px;
      z-index: 1000;
    }

    .notification.error {
      background-color: #ff6b81;
    }

    /* Estilos para el código de barras simulado */
    .barcode {
      height: 60px;
      background:
        repeating-linear-gradient(90deg,
          #000 0, #000 2px,
          transparent 2px, transparent 4px);
      background-size: 4px 100%;
      position: relative;
      margin: 0 auto;
    }

    .barcode::before,
    .barcode::after {
      content: '';
      position: absolute;
      height: 100%;
      width: 4px;
      background-color: #000;
    }

    .barcode::before {
      left: 10%;
    }

    .barcode::after {
      right: 10%;
    }

    .barcode-number {
      text-align: center;
      margin-top: 5px;
      font-family: 'Libre Barcode 128', cursive;
      font-size: 24px;
      letter-spacing: 2px;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+128&display=swap" rel="stylesheet">
</head>

<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo-section">
          <i class="fas fa-print"></i>
          <div>
            <h1>Generador de Etiquetas Zebra ZD421</h1>
            <p class="subtitle">Crea y envía etiquetas compatibles con tu impresora Zebra vía USB</p>
          </div>
        </div>
        <div class="connection-status">
          <div class="status-indicator" id="statusIndicator"></div>
          <span id="statusText">No conectado</span>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <main>
      <div class="card">
        <h2><i class="fas fa-edit"></i> Configurar Etiqueta</h2>
        <div class="form-group">
          <label for="productName">Nombre del Producto</label>
          <input type="text" id="productName" class="form-control" value="PRODUCTO DE EJEMPLO" placeholder="Ingrese el nombre del producto">
        </div>

        <div class="form-group">
          <label for="productCode">Código del Producto</label>
          <input type="text" id="productCode" class="form-control" value="PRD-2023-001" placeholder="Ingrese el código del producto">
        </div>

        <div class="form-group">
          <label for="productPrice">Precio ($)</label>
          <input type="text" id="productPrice" class="form-control" value="29.99" placeholder="Ingrese el precio">
        </div>

        <div class="form-group">
          <label for="productDate">Fecha de Caducidad</label>
          <input type="date" id="productDate" class="form-control" value="2023-12-31">
        </div>

        <div class="form-group">
          <label for="barcodeType">Tipo de Código de Barras</label>
          <select id="barcodeType" class="form-control">
            <option value="CODE128">CODE128</option>
            <option value="CODE39">CODE39</option>
            <option value="EAN13">EAN-13</option>
            <option value="QRCODE">QR Code</option>
          </select>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="showPrice" checked>
          <label for="showPrice">Mostrar precio en etiqueta</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="showDate" checked>
          <label for="showDate">Mostrar fecha de caducidad</label>
        </div>

        <div class="actions">
          <button class="btn btn-primary" id="generateBtn">
            <i class="fas fa-sync-alt"></i> Generar Etiqueta
          </button>
          <button class="btn btn-secondary" id="resetBtn">
            <i class="fas fa-redo"></i> Restablecer
          </button>
        </div>
      </div>

      <div class="card">
        <h2><i class="fas fa-eye"></i> Vista Previa</h2>
        <div class="preview-container">
          <div class="label-preview">
            <div class="preview-content">
              <div class="preview-title" id="previewTitle">PRODUCTO DE EJEMPLO</div>
              <div class="preview-barcode">
                <div class="barcode"></div>
              </div>
              <div class="barcode-number" id="previewBarcode">PRD-2023-001</div>
              <div class="preview-details">
                <div id="previewPrice"><strong>Precio:</strong> $29.99</div>
                <div id="previewDate"><strong>Caducidad:</strong> 31/12/2023</div>
                <div id="previewCode"><strong>Código:</strong> PRD-2023-001</div>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <button class="btn btn-success" id="printBtn">
            <i class="fas fa-print"></i> Imprimir Etiqueta
          </button>
          <button class="btn btn-secondary" id="saveBtn">
            <i class="fas fa-save"></i> Guardar ZPL
          </button>
        </div>
      </div>

      <div class="card zpl-output">
        <h2><i class="fas fa-code"></i> Código ZPL Generado</h2>
        <p>Este es el código ZPL que se enviará a la impresora Zebra ZD421:</p>
        <div class="zpl-container" id="zplOutput">
          ^XA
          ^FO50,50^A0N,36,36^FDPRODUCTO DE EJEMPLO^FS
          ^FO50,100^BY2^BCN,100,Y,N,N^FDPRD-2023-001^FS
          ^FO50,220^A0N,28,28^FDPrecio: $29.99^FS
          ^FO50,260^A0N,28,28^FDCaducidad: 31/12/2023^FS
          ^FO50,300^A0N,28,28^FDCódigo: PRD-2023-001^FS
          ^XZ
        </div>
        <div class="instructions">
          <h3>Instrucciones para imprimir:</h3>
          <ol>
            <li>Conecta la impresora Zebra ZD421 a tu computadora mediante USB</li>
            <li>Asegúrate de que la impresora esté encendida y tenga papel</li>
            <li>Haz clic en "Imprimir Etiqueta" para enviar el código ZPL directamente a la impresora</li>
            <li>Si la impresión no funciona, copia el código ZPL y pégalo en el software de tu impresora</li>
          </ol>
        </div>
      </div>
    </main>

    <footer>
      <p>Generador de Etiquetas Zebra ZD421 &copy; 2023 - Compatible con impresoras Zebra ZD421 vía USB</p>
    </footer>
  </div>

  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">Etiqueta generada correctamente</span>
  </div>

  <script>
    // Elementos del DOM
    const productName = document.getElementById('productName');
    const productCode = document.getElementById('productCode');
    const productPrice = document.getElementById('productPrice');
    const productDate = document.getElementById('productDate');
    const barcodeType = document.getElementById('barcodeType');
    const showPrice = document.getElementById('showPrice');
    const showDate = document.getElementById('showDate');
    const generateBtn = document.getElementById('generateBtn');
    const resetBtn = document.getElementById('resetBtn');
    const printBtn = document.getElementById('printBtn');
    const saveBtn = document.getElementById('saveBtn');
    const zplOutput = document.getElementById('zplOutput');
    const statusIndicator = document.getElementById('statusIndicator');
    const statusText = document.getElementById('statusText');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    // Elementos de vista previa
    const previewTitle = document.getElementById('previewTitle');
    const previewBarcode = document.getElementById('previewBarcode');
    const previewPrice = document.getElementById('previewPrice');
    const previewDate = document.getElementById('previewDate');
    const previewCode = document.getElementById('previewCode');
    // Estado de la aplicación
    let isConnected = false;
    let currentZPL = '';
    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
      updatePreview();
      generateZPL();
      checkPrinterConnection();
      // Event Listeners
      productName.addEventListener('input', updatePreview);
      productCode.addEventListener('input', updatePreview);
      productPrice.addEventListener('input', updatePreview);
      productDate.addEventListener('input', updatePreview);
      barcodeType.addEventListener('change', updatePreview);
      showPrice.addEventListener('change', updatePreview);
      showDate.addEventListener('change', updatePreview);
      generateBtn.addEventListener('click', function() {
        updatePreview();
        generateZPL();
        showNotification('Etiqueta generada correctamente');
      });
      resetBtn.addEventListener('click', resetForm);
      printBtn.addEventListener('click', printLabel);
      saveBtn.addEventListener('click', saveZPL);
      // Simular estado de conexión
      setInterval(checkPrinterConnection, 5000);
    });
    // Actualizar vista previa
    function updatePreview() {
      const name = productName.value || 'PRODUCTO DE EJEMPLO';
      const code = productCode.value || 'PRD-2023-001';
      const price = productPrice.value || '0.00';
      const date = productDate.value || '2023-12-31';
      const showPriceChecked = showPrice.checked;
      const showDateChecked = showDate.checked;
      // Formatear fecha
      const dateObj = new Date(date);
      const formattedDate = dateObj.toLocaleDateString('es-ES');
      // Actualizar elementos de vista previa
      previewTitle.textContent = name.toUpperCase();
      previewBarcode.textContent = code;
      previewCode.innerHTML = `<strong>Código:</strong> ${code}`;
      if (showPriceChecked) {
        previewPrice.innerHTML = `<strong>Precio:</strong> $${parseFloat(price).toFixed(2)}`;
        previewPrice.style.display = 'block';
      } else {
        previewPrice.style.display = 'none';
      }
      if (showDateChecked) {
        previewDate.innerHTML = `<strong>Caducidad:</strong> ${formattedDate}`;
        previewDate.style.display = 'block';
      } else {
        previewDate.style.display = 'none';
      }
      // Actualizar código de barras simulado
      updateBarcodePreview();
    }
    // Actualizar vista previa del código de barras
    function updateBarcodePreview() {
      const barcodeEl = document.querySelector('.barcode');
      const type = barcodeType.value;
      // Simular diferentes tipos de códigos de barras
      if (type === 'QRCODE') {
        barcodeEl.style.background = 'repeating-linear-gradient(0deg, #000 0, #000 2px, transparent 2px, transparent 4px), repeating-linear-gradient(90deg, #000 0, #000 2px, transparent 2px, transparent 4px)';
        barcodeEl.style.backgroundSize = '4px 4px';
        barcodeEl.style.height = '80px';
        barcodeEl.style.width = '80px';
        barcodeEl.style.margin = '0 auto';
      } else {
        barcodeEl.style.background = 'repeating-linear-gradient(90deg, #000 0, #000 2px, transparent 2px, transparent 4px)';
        barcodeEl.style.backgroundSize = '4px 100%';
        barcodeEl.style.height = '60px';
        barcodeEl.style.width = '80%';
      }
    }
    // Generar código ZPL
    function generateZPL() {
      const name = productName.value || 'PRODUCTO DE EJEMPLO';
      const code = productCode.value || 'PRD-2023-001';
      const price = productPrice.value || '0.00';
      const date = productDate.value || '2023-12-31';
      const type = barcodeType.value;
      const showPriceChecked = showPrice.checked;
      const showDateChecked = showDate.checked;
      // Formatear fecha
      const dateObj = new Date(date);
      const formattedDate = dateObj.toLocaleDateString('es-ES');
      // Determinar comando de código de barras según el tipo
      let barcodeCommand = '';
      if (type === 'QRCODE') {
        barcodeCommand = `^FO50,100^BQN,2,10^FDQA,${code}^FS`;
      } else {
        // CODE128 por defecto
        barcodeCommand = `^FO50,100^BY2^BCN,100,Y,N,N^FD${code}^FS`;
      }
      // Construir ZPL
      let zpl = `^XA\n`;
      zpl += `^FO50,50^A0N,36,36^FD${name.toUpperCase()}^FS\n`;
      zpl += `${barcodeCommand}\n`;
      let yPosition = 220;
      if (showPriceChecked) {
        zpl += `^FO50,${yPosition}^A0N,28,28^FDPrecio: $${parseFloat(price).toFixed(2)}^FS\n`;
        yPosition += 40;
      }
      if (showDateChecked) {
        zpl += `^FO50,${yPosition}^A0N,28,28^FDCaducidad: ${formattedDate}^FS\n`;
        yPosition += 40;
      }
      zpl += `^FO50,${yPosition}^A0N,28,28^FDCódigo: ${code}^FS\n`;
      zpl += `^XZ`;
      currentZPL = zpl;
      zplOutput.textContent = zpl;
    }
    // Restablecer formulario
    function resetForm() {
      productName.value = 'PRODUCTO DE EJEMPLO';
      productCode.value = 'PRD-2023-001';
      productPrice.value = '29.99';
      // Establecer fecha a 3 meses en el futuro
      const futureDate = new Date();
      futureDate.setMonth(futureDate.getMonth() + 3);
      productDate.value = futureDate.toISOString().split('T')[0];
      barcodeType.value = 'CODE128';
      showPrice.checked = true;
      showDate.checked = true;
      updatePreview();
      generateZPL();
      showNotification('Formulario restablecido');
    }
    // Verificar conexión de la impresora (simulada)
    function checkPrinterConnection() {
      // En un entorno real, aquí se verificaría la conexión USB
      // Por ahora, simulamos una conexión aleatoria para demostración
      const connected = Math.random() > 0.3; // 70% de probabilidad de estar "conectado"
      if (connected !== isConnected) {
        isConnected = connected;
        if (isConnected) {
          statusIndicator.className = 'status-indicator connected';
          statusText.textContent = 'Conectado a Zebra ZD421';
          printBtn.disabled = false;
          printBtn.innerHTML = '<i class="fas fa-print"></i> Imprimir Etiqueta';
        } else {
          statusIndicator.className = 'status-indicator';
          statusText.textContent = 'No conectado';
          printBtn.disabled = true;
          printBtn.innerHTML = '<i class="fas fa-print"></i> Conecta la impresora';
        }
      }
    }
    // Imprimir etiqueta
    async function printLabel() {
      if (!isConnected) {
        showNotification('Error: No hay impresora conectada', true);
        return;
      }
      showNotification('Enviando etiqueta a la impresora...');
      // En un entorno real, aquí se enviaría el ZPL a la impresora USB
      // Esto generalmente requiere una API específica o un complemento
      // Para esta demo, simularemos el proceso de impresión
      setTimeout(() => {
        // Simulación de impresión exitosa
        showNotification('Etiqueta enviada a la impresora correctamente');
        // Simulación de error ocasional
        if (Math.random() < 0.2) { // 20% de probabilidad de error
          setTimeout(() => {
            showNotification('Error: No se pudo imprimir la etiqueta', true);
          }, 1500);
        }
      }, 1500);
    }
    // Guardar código ZPL como archivo
    function saveZPL() {
      const blob = new Blob([currentZPL], {
        type: 'text/plain'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `etiqueta_zebra_${Date.now()}.zpl`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showNotification('Archivo ZPL guardado correctamente');
    }
    // Mostrar notificación
    function showNotification(message, isError = false) {
      notificationText.textContent = message;
      if (isError) {
        notification.className = 'notification error';
      } else {
        notification.className = 'notification';
      }
      notification.style.display = 'flex';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }
    // Para una implementación real con USB, se necesitaría usar la WebUSB API
    // Aquí hay un esqueleto de cómo podría implementarse:
    /*
    async function connectToPrinter() {
        try {
            // Solicitar acceso a la impresora Zebra
            const device = await navigator.usb.requestDevice({
                filters: [{ vendorId: 0x0A5F }] // ID de vendedor de Zebra
            });
            
            // Conectar al dispositivo
            await device.open();
            await device.selectConfiguration(1);
            await device.claimInterface(0);
            
            isConnected = true;
            statusIndicator.className = 'status-indicator connected';
            statusText.textContent = `Conectado a ${device.productName}`;
            
            return device;
        } catch (error) {
            console.error('Error conectando a la impresora:', error);
            isConnected = false;
            statusIndicator.className = 'status-indicator';
            statusText.textContent = 'No conectado';
            return null;
        }
    }
    
    async function sendToPrinter(zplCode) {
        const device = await connectToPrinter();
        if (!device) return false;
        
        try {
            // Convertir ZPL a bytes
            const encoder = new TextEncoder();
            const data = encoder.encode(zplCode);
            
            // Enviar datos a la impresora
            await device.transferOut(1, data);
            
            // Cerrar conexión
            await device.close();
            
            return true;
        } catch (error) {
            console.error('Error enviando a la impresora:', error);
            return false;
        }
    }
    */
  </script>
</body>

</html>
